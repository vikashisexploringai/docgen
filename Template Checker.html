<!DOCTYPE html>
<html>
<head>
    <title>Advanced Template Checker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .char-detail { font-family: monospace; background: #f5f5f5; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body>
    <h2>Advanced DOCX Template Checker</h2>
    <input type="file" id="templateFile" accept=".docx">
    <div id="output" style="margin-top: 20px;"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <script>
        function analyzePlaceholder(text) {
            const chars = text.split('');
            const analysis = chars.map((char, index) => {
                const code = char.charCodeAt(0);
                let type = 'normal';
                if (code === 32) type = 'SPACE';
                else if (code === 9) type = 'TAB';
                else if (code === 10) type = 'NEWLINE';
                else if (code === 13) type = 'CARRIAGE_RETURN';
                else if (code === 160) type = 'NBSP (non-breaking space)';
                else if (code < 32) type = 'CONTROL_CHAR';
                
                return { char, code, type, index };
            });
            
            return analysis;
        }

        document.getElementById('templateFile').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const output = document.getElementById('output');
            output.innerHTML = '<div>Loading template...</div>';
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const zip = await JSZip.loadAsync(arrayBuffer);
                const documentXml = await zip.file('word/document.xml').async('text');
                
                // Find all placeholders
                const placeholderPattern = /\{\{[^{}]+\}\}/g;
                const matches = documentXml.match(placeholderPattern) || [];
                
                let html = `<h3>Found ${matches.length} Placeholders:</h3>`;
                
                matches.forEach(match => {
                    const isValid = /^\{\{[A-Za-z0-9_]+\}\}$/.test(match);
                    const analysis = analyzePlaceholder(match);
                    
                    html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid ${isValid ? 'green' : 'red'};">`;
                    html += `<strong>${match}</strong> - ${isValid ? 'VALID' : 'INVALID'}`;
                    html += `<div class="char-detail">`;
                    analysis.forEach(item => {
                        html += `[${item.index}] '${item.char}' â†’ ${item.code} (${item.type})<br>`;
                    });
                    html += `</div></div>`;
                });
                
                output.innerHTML = html;
                
            } catch (error) {
                output.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
